<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Facing">
	<resultMap type="Facing" id="FacingResultSet">
		<id property="empNo" column="EMP_NO" />
		<result property="empName" column="EMP_NAME" />
		<result property="facingNo" column="FACING_NO" />
		<result property="facingTitle" column="FACING_TITLE" />
		<result property="facingContents" column="FACING_CONTENTS" />
		<result property="writeDate" column="WRITE_DATE" />
		<result property="receiver" column="RECEIVER" />
		<result property="status" column="STATUS" />
		<result property="receiverDate" column="RECEIVER_DATE" />
		<result property="depId" column="DEP_ID" />
		<result property="depName" column="DEP_NAME" />
		
	</resultMap>
		<resultMap type="FacingInsert" id="FacingIResultSet">
		<id property="empNo" column="EMP_NO" />
		<result property="empName" column="EMP_NAME" />
		<result property="facingNo" column="FACING_NO" />
		<result property="facingTitle" column="FACING_TITLE" />
		<result property="facingContents" column="FACING_CONTENTS" />
		<result property="writeDate" column="WRITE_DATE" />
		<result property="receiver" column="RECEIVER" />
		<result property="status" column="STATUS" />
		<result property="receiverDate" column="RECEIVER_DATE" />
	</resultMap>
	
		<resultMap type="FacingInsertR" id="FacingRResultSet">
		<result property="facingNo" column="FACING_NO" />
		<result property="receiver" column="RECEIVER" />	
		<result property="receiverDate" column="RECEIVER_DATE" />
	</resultMap>
	
	<!-- <resultMap type="WorkginRecord" id="WorkingResultSet">
		<id property="empNo" column="EMP_NO" />
		<result property="hours" column="HOURS" />
		<result property="workRecordNo" column="WORK_RECORD_NO" />	
	</resultMap> -->
	
	<!-- 출석 -->
	<insert id="insertWorking" parameterType="WorkingRecord">
	
    INSERT INTO "FINAL"."WORKING_RECORD"(WORK_RECORD_NO,HOURS,EMP_NO)
    VALUES (WORK_RECORD_NO.NEXTVAL,SYSDATE,#{empNo})

	</insert>
	
	
	
	<!--  보낸 쪽지 리스트-->
	<select id="selectFacing" resultMap="FacingResultSet" parameterType="int">
 	SELECT F.WRITE_DATE , E.EMP_NAME , F.FACING_TITLE , F.FACING_CONTENTS, F.FACING_NO , RECEIVER 
	FROM FACING F JOIN EMPLOYEE E ON (F.EMP_NO = E.EMP_NO) JOIN FACING_RECEIVE FR ON (F.FACING_NO = FR.FACING_NO)
	WHERE F.EMP_NO = #{empNo} AND F.STATUS = 'Y'
	</select>
	
	<select id="reciveFacing" resultMap="FacingResultSet" parameterType="int">
	SELECT WRITE_DATE,FACING_TITLE , FACING_CONTENTS, EMP_NAME ,F.FACING_NO , F.EMP_NO
	FROM FACING F JOIN FACING_RECEIVE FR ON (F.FACING_NO = FR.FACING_NO) 
	JOIN EMPLOYEE E ON (F.EMP_NO = E.EMP_NO) WHERE RECEIVER = #{receiver} AND F.STATUS = 'Y'
	</select>
	
	<select id ="selectOneFacing" resultMap="FacingResultSet" parameterType="int">
	SELECT F.WRITE_DATE , E.EMP_NAME , F.FACING_TITLE , F.FACING_CONTENTS 
	FROM FACING F JOIN EMPLOYEE E ON (F.EMP_NO = E.EMP_NO) 
    WHERE F.FACING_NO = #{facingNo}
	</select>
	
	<update id="updateFacing" parameterType="int">
	UPDATE FACING SET STATUS = 'N' WHERE FACING_NO = #{facingNo} 
	</update>
	<insert id="insertFacing" parameterType="FacingInsert">
	  
      INSERT INTO "FINAL"."FACING" (FACING_NO, FACING_TITLE, FACING_CONTENTS, WRITE_DATE, EMP_NO, STATUS) 
  	  VALUES (FACING_NO.NEXTVAL, #{facingTitle}, #{facingContents}, SYSDATE,#{empNo}, 'Y')
            
	</insert>
	
	<select id="selectNowFaicng" resultMap="FacingResultSet" parameterType="int">
	SELECT FACING_NO ,WRITE_DATE FROM
	FACING 
	WHERE WRITE_DATE = (SELECT MAX(WRITE_DATE)FROM FACING WHERE EMP_NO=1000)
	AND EMP_NO = #{empNo}
	AND ROWNUM = 1 
	ORDER BY FACING_NO DESC
	</select>
	<insert id="insertFaicngR" parameterType="FacingInsertR">
	INSERT INTO "FINAL"."FACING_RECEIVE" (FACING_NO, RECEIVER, RECEIVE_DATE) 
	VALUES (#{facingNo}, #{receiver}, SYSDATE)
	</insert>
	
<!-- 	   쪽지보내기 쿼리문 
   <insert id="insertFacing"  parameterType="Facing">
      INSERT INTO FACING
      VALUES(FACING_NO.NEXTVAL, #{facingTitle}, #{facingContens}, SYSDATE, 
            #{empNo}, 'Y')
      
   </insert>
   
      <insert id="insertFacing"  parameterType="Facing">
      INSERT INTO FACING_RECEIVE
      VALUES(FACING_NO.NEXTVAL, #{RECEIVER}, SYSDATE)
   	  </insert>
   
  -->
</mapper>

















